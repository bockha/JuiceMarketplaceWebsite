<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8">
	<link href="../lib/jquery-ui-1.12.1/jquery-ui.css" rel="stylesheet">
	<link href="../lib/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/style.css">
	<script src="../lib/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
	<script src="../lib/jquery-ui-1.12.1/jquery-ui.js"></script>
	<script src="../lib/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
	<!-- Program Configurator -->
	<link rel="stylesheet" href="juice-configurator/css/program-configurator.css">
	<link rel="stylesheet" href="css/configurator.css">
	<script src="juice-configurator/js/recipe.js"></script>
	<script src="juice-configurator/js/program-configurator.js"></script>
	<script src="js/configurator.js"></script>
	<script src="../../services/program_converter.js"></script>
</head>
<body>
<div id="main2">
	<!-- Templates start -->
	<div id="dialog-phase" title="Phase einstellen" style="display: none">
		<p class="validateTips">Wieviel ml abspalten?</p>		
		<fieldset>
			<label for="splitml">Milliliter: </label>
			<input type="text" name="splitml" id="splitml" value="50" class="text ui-widget-content ui-corner-all">
		</fieldset>
	</div>

	<div id="dialog-change-amount" title="Menge einstellen" style="display: none">
		<p class="validateTips">Wieviel ml?</p>
		<fieldset>
			<label for="changeml">Milliliter: </label>
			<input type="text" name="changeml" id="changeml" value="0" class="text ui-widget-content ui-corner-all">
		</fieldset>
	</div>

	<div id="dialog-add-ingredient" title="Zutat hinzufügen" style="display: none">
		<input type="hidden" name="ingredientId" value="">
		<div id="dialog-add-ingredient-table">
			<input type="text" id="ingredientSearchBox" onkeyup="ingredientSearch()" placeholder="Zutat suchen">
			<div class="table">
				<table id="ingredientTable">
					<tr class="header">
						<th style="width:60%;">Name</th>
						<th style="width:40%;">Beschreibung</th>
					</tr>
					<tr class="ingredient">
						<td class="name"></td>
						<td class="description"></td>
					</tr>
				</table>
			</div>
		</div>
		<div id="dialog-add-ingredient-amount">
			<!--<form>-->
				<!--<fieldset>-->
				<span class="ingredient">Zutat:</span><br>
				<label for="addml">Milliliter: </label>
				<input type="text" name="addml" id="addml" value="50" class="text ui-widget-content ui-corner-all">
				<!--</fieldset>-->
			<!--</form>-->
		</div>
		<!--<p class="validateTips">Welche Zutat möchten Sie hinzufügen?</p>
		<form>
			<fieldset>
			<label for="addml">Milliliter: </label>
			<input type="text" name="addml" id="addml" value="50" class="text ui-widget-content ui-corner-all">
			</fieldset>
		</form>-->
	</div>

	<div id="program-template" style="display: none">
		<div id="program-header" class="row">
			<div class="col-xs-1"></div>
			<div class="col-xs-2 program-row program-row-label"><span></span></div>
			<div class="col-xs-8 program-row content"></div>
			<div class="col-xs-1"></div>
		</div>
		<div id="program-sequence" class="row sequence">
			<div class="col-xs-1"></div>
			<div class="col-xs-2 program-row program-row-label"><span class="label"></span></div>
			<div class="col-xs-7 program-row content">
				<div id="program-phase" class="phase">
					<div class="phase-ml"></div>
					<span class="phase-label"></span>
					<div class="phase-controls" style="display: none;">
						<div class="phase-controls-center"></div>
						<div class="phase-controls-right"></div>
					</div>
				</div>
			</div>
			<div class="col-xs-1 program-row-total"><a href="javascript:void(0);" class="total-label change-amount">150 ml</a></div>
			<div class="col-xs-1"></div>
		</div>
		<div id="program-pause" class="row">
			<div class="col-xs-1"></div>
			<div class="col-xs-2 program-row-label program-row"><span class="label"></span></div>
			<div class="col-xs-7 program-row content">
				<div id="program-pause-phase" class="pause-phase">
					<span class="phase-label"></span>
				</div>				
			</div>
			<div class="col-xs-1 program-row-total">150 ml</div>
			<div class="col-xs-1"></div>
		</div>
		<div id="program-footer" class="row">
			<div class="col-xs-1"></div>
			<div class="col-xs-2 program-row program-row-label"><a href="javascript:void(0);" class="add-ingredient">Zutat hinzufügen</a></div>
			<div class="col-xs-8 program-row content"></div>
			<div class="col-xs-1"></div>
		</div>
	</div>
	<!-- Templates end -->

	<div class="tdmc-page">
		<div class="container-fluid">
			<div class="row">
				<button id="button-save" class="ui-button ui-widget ui-corner-all" style="float: right;">Speichern</button>
			</div>
			<div class="row">
				 <h3>Produktdetails</h3> 
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Titel</p></div>
				<div class="col-sm-8"><input id="recipe-title" type="text" style="width: 100%;"></div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Kurze Beschreibung</p></div>
				<div class="col-sm-8"><input id="recipe-short-description" type="text" style="width: 100%;"></div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Vollständige Beschreibung</p></div>
				<div class="col-sm-8"><textarea id="recipe-description" style="width: 100%; height: 100px;"></textarea></div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Rezeptur</p></div>
			</div>
			<div id="program"></div>
			<!--<div id="recipe-pauses" class="">
				<div class="row">
					<div class="col-xs-1"></div>
					<div class="col-xs-2 program-row program-row-label">Pausen</div>
					<div class="col-xs-8 program-row content"></div>
					<div class="col-xs-1"></div>
				</div>
			</div>-->
			<div class="row config">
				<div class="col-sm-3"><p class="label">Grafische Elemente</p></div>
			</div>
			<div class="row">
				<div class="col-xs-1"></div>
				<div id="previews" class="col-xs-10">
					<div class="preview">
					<form method="post" action="https://isource.de//?" enctype="multipart/form-data" novalidate="" class="box" style="display: table;">
					<div style="padding-top: 100px 200px;">+<br>Bild hinzufügen</div>
					</form>
					</div>
				</div>
				<div class="col-xs-1"></div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Kategorisierung</p></div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Lizenzgebühr</p></div>
				<div class="col-sm-8">
					<select name="license-fee" id="license-fee">
					</select>
				</div>
			</div>
			<div class="row config">
				<div class="col-sm-3"><p class="label">Verkaufsstatus</p></div>
				<div class="col-sm-8"><input type="text" style="width: 100%; height: 100px;"></div>
			</div>

		</div>
	</div>
</div>
<script>

	// var apfelsaft = new Ingredient("Apfelsaft", 1);
	// var bananensaft = new Ingredient("Bananensaft", 1);
	// var sprudel = new Ingredient("Sprudel", 1);

	// var ingredients = [
	// 	apfelsaft,
	// 	bananensaft,
	// 	sprudel,
	// ];

	console.log("Setup Recipe");
	var recipe = new Recipe();
	recipe.title = "Apfel-/Bananenschorle";
	recipe.shortDescription = "Short description";
	recipe.description = "Long description";
	recipe.licenseFee = 0.55;
//	recipe.title = "Apfel-/Bananenschorle";

	// var recipe = new Recipe("Apfel-/Bananenschorle");
	// var sequence = new Sequence(ingredients[0].id);
	// sequence.addPhase(new Phase(0, 100, 100));
	// sequence.addPhase(new Phase(110, 130, 100));
	// recipe.addSequence(sequence);

	// sequence = new Sequence(ingredients[1].id);
	// sequence.addPhase(new Phase(0, 80, 100));
	// sequence.addPhase(new Phase(100, 40, 80));
	// sequence.addPhase(new Phase(150, 100, 100));
	// recipe.addSequence(sequence);

	// sequence = new Sequence(sprudel.id);
	// sequence.addPhase(new Phase(60, 200, 70));
	// recipe.addSequence(sequence);

	var programConfigurator = new ProgramConfigurator(recipe.program, "program");
	programConfigurator.render();

		// var apfelsaft = new Ingredient("Apfelsaft");
		// apfelsaft.phases.push(new Phase(apfelsaft, 0, 100, 100));
		// apfelsaft.phases.push(new Phase(apfelsaft, 110, 130, 100));
		// recipe.addIngredient(apfelsaft);

		// var bananensaft = new Ingredient("Bananensaft");
		// bananensaft.phases.push(new Phase(bananensaft, 0, 80, 100));
		// bananensaft.phases.push(new Phase(bananensaft, 100, 40, 80));
		// bananensaft.phases.push(new Phase(bananensaft, 150, 100, 100));
		// recipe.addIngredient(bananensaft);

		// var sprudel = new Ingredient("Sprudel");
		// sprudel.phases.push(new Phase(sprudel, 60, 200, 70));
		// recipe.addIngredient(sprudel);

		// updateHtml(recipe);
		$('#recipe-title').on("input", function() {
			recipe.title = this.value;
		});

		$('#recipe-short-description').on("input", function() {
			recipe.shortDescription = this.value;
		});

		$('#recipe-description').on("input", function() {
			recipe.description = this.value;
		});

		$('#button-save').on("click", function() {
			// validate recipe
			var valid = true;
			if (valid && recipe.title == "") {
				alert("Bitte geben Sie einen Titel ein.");
				valid = false;
			}
			if (valid && recipe.shortDescription == "") {
				alert("Bitte geben Sie eine Kurzbeschreibung ein.");
				valid = false;
			}
			if (valid && recipe.description == "") {
				alert("Bitte geben Sie eine Beschreibung ein.");
				valid = false;
			}
			if (valid && recipe.licenseFee == -1) {
				alert("Bitte wählen Sie eine Lizenzgebühr aus.");
				valid = false;
			}
			if (valid) {
				var json = recipe.toJSON();
				console.log("JSON = "+jsonString);
				var jsonString = JSON.stringify(json);
				var recovery = JSON.parse(jsonString);
				var rec = Recipe.fromJSON(recovery);
				var converter = new ProgramConverter();
				var machineCode = converter.convert(rec.program);
				var machineCodeString = JSON.stringify(machineCode);
				console.log("Machine-Code:\n\n"+machineCodeString);
				// convertJSONRecipe(jsonString);
				// convertProgramToMachinecode(recipe.program);
			}
		});

		$( "#license-fee" ).selectmenu();

		var formatter = new Intl.NumberFormat('de-DE', {
			style: 'currency',
			currency: 'EUR',
			minimumFractionDigits: 2,
		});
		var licenseFeeTiers = [0.49, 0.99, 1.49, 1.99, 2.99, 3.99, 4.99, 5.99, 7.99, 9.99, 14.99, 19.99];
		licenseFeeTiers.forEach(function(tier) {
			var fee = formatter.format(tier);
			$( "#license-fee" ).append($('<option></option>').val(tier).html(fee));
		});

		function convertJSONRecipe(recipe) {
			alert("Converting recipe: "+recipe);
		}

		function convertProgramToMachinecode(program) {
			var converter = new ProgramConverter(program);
			converter.convert();
		}

</script>
</body>
</html>